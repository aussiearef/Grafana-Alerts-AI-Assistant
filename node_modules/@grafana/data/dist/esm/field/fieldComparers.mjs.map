{"version":3,"file":"fieldComparers.mjs","sources":["../../../src/field/fieldComparers.ts"],"sourcesContent":["import { isNumber } from 'lodash';\n\nimport { isDateTimeInput, dateTime } from '../datetime/moment_wrapper';\nimport { Field, FieldType } from '../types/dataFrame';\n\ntype IndexComparer = (a: number, b: number) => number;\n\nexport const fieldIndexComparer = (field: Field, reverse = false): IndexComparer => {\n  const values = field.values;\n\n  switch (field.type) {\n    case FieldType.number:\n      return numericIndexComparer(values, reverse);\n    case FieldType.string:\n      return stringIndexComparer(values, reverse);\n    case FieldType.boolean:\n      return booleanIndexComparer(values, reverse);\n    case FieldType.time:\n      if (typeof field.values[0] === 'number') {\n        return timestampIndexComparer(values, reverse);\n      }\n      return timeIndexComparer(values, reverse);\n    default:\n      return naturalIndexComparer(reverse);\n  }\n};\n\nconst timeComparer = (a: unknown, b: unknown): number => {\n  if (!a || !b) {\n    return falsyComparer(a, b);\n  }\n\n  if (isNumber(a) && isNumber(b)) {\n    return numericComparer(a, b);\n  }\n\n  if (isDateTimeInput(a) && isDateTimeInput(b)) {\n    if (dateTime(a).isBefore(b)) {\n      return -1;\n    }\n\n    if (dateTime(b).isBefore(a)) {\n      return 1;\n    }\n  }\n\n  return 0;\n};\n\nconst numericComparer = (a: number, b: number): number => {\n  return a - b;\n};\n\n// Using the Intl.Collator object compare method results in much faster\n// string sorting than .localeCompare\nconst compare = new Intl.Collator('en', { sensitivity: 'base' }).compare;\n\nconst stringComparer = (a: string, b: string): number => {\n  if (!a || !b) {\n    return falsyComparer(a, b);\n  }\n\n  return compare(String(a), String(b));\n};\n\nconst booleanComparer = (a: boolean, b: boolean): number => {\n  return falsyComparer(a, b);\n};\n\nconst falsyComparer = (a: unknown, b: unknown): number => {\n  if (!a && b) {\n    return 1;\n  }\n\n  if (a && !b) {\n    return -1;\n  }\n\n  return 0;\n};\n\nconst timestampIndexComparer = (values: number[], reverse: boolean): IndexComparer => {\n  let mult = reverse ? -1 : 1;\n  return (a: number, b: number): number => mult * (values[a] - values[b]);\n};\n\nconst timeIndexComparer = (values: unknown[], reverse: boolean): IndexComparer => {\n  return (a: number, b: number): number => {\n    const vA = values[a];\n    const vB = values[b];\n    return reverse ? timeComparer(vB, vA) : timeComparer(vA, vB);\n  };\n};\n\nconst booleanIndexComparer = (values: boolean[], reverse: boolean): IndexComparer => {\n  return (a: number, b: number): number => {\n    const vA = values[a];\n    const vB = values[b];\n    return reverse ? booleanComparer(vB, vA) : booleanComparer(vA, vB);\n  };\n};\n\nconst numericIndexComparer = (values: number[], reverse: boolean): IndexComparer => {\n  return (a: number, b: number): number => {\n    const vA = values[a];\n    const vB = values[b];\n    return reverse ? numericComparer(vB, vA) : numericComparer(vA, vB);\n  };\n};\n\nconst stringIndexComparer = (values: string[], reverse: boolean): IndexComparer => {\n  return (a: number, b: number): number => {\n    const vA = values[a];\n    const vB = values[b];\n    return reverse ? stringComparer(vB, vA) : stringComparer(vA, vB);\n  };\n};\n\nconst naturalIndexComparer = (reverse: boolean): IndexComparer => {\n  return (a: number, b: number): number => {\n    return reverse ? numericComparer(b, a) : numericComparer(a, b);\n  };\n};\n"],"names":[],"mappings":"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"}