{"version":3,"file":"datasource.mjs","sources":["../../../src/utils/datasource.ts"],"sourcesContent":["import { isString } from 'lodash';\n\nimport { DataSourceRef } from '@grafana/schema';\n\nimport { KeyValue } from '../types/data';\nimport {\n  DataSourceInstanceSettings,\n  DataSourceJsonData,\n  DataSourcePluginOptionsEditorProps,\n  DataSourceSettings,\n} from '../types/datasource';\nimport { SelectableValue } from '../types/select';\n\n/**\n * Convert instance settings to a reference\n *\n * @public\n */\nexport function getDataSourceRef(ds: DataSourceInstanceSettings): DataSourceRef {\n  const ref: DataSourceRef = { uid: ds.uid, type: ds.type };\n  if (ds.apiVersion) {\n    ref.apiVersion = ds.apiVersion;\n  }\n  return ref;\n}\n\n/**\n * Returns true if the argument is a DataSourceRef\n *\n * @public\n */\nexport function isDataSourceRef(ref: DataSourceRef | string | null | undefined): ref is DataSourceRef {\n  return typeof ref === 'object' && typeof ref?.uid === 'string';\n}\n\n/**\n * Get the UID from a string of reference\n *\n * @public\n */\nexport function getDataSourceUID(ref: DataSourceRef | string | null): string | undefined {\n  if (isDataSourceRef(ref)) {\n    return ref.uid;\n  }\n  if (isString(ref)) {\n    return ref;\n  }\n  return undefined;\n}\n\nexport const onUpdateDatasourceOption =\n  (props: DataSourcePluginOptionsEditorProps, key: keyof DataSourceSettings) =>\n  (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => {\n    updateDatasourcePluginOption(props, key, event.currentTarget.value);\n  };\n\nexport const onUpdateDatasourceJsonDataOption =\n  <J extends DataSourceJsonData, S, K extends keyof J>(props: DataSourcePluginOptionsEditorProps<J, S>, key: K) =>\n  (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => {\n    updateDatasourcePluginJsonDataOption(props, key, event.currentTarget.value);\n  };\n\nexport const onUpdateDatasourceSecureJsonDataOption =\n  <J extends DataSourceJsonData, S extends {} = KeyValue>(\n    props: DataSourcePluginOptionsEditorProps<J, S>,\n    key: string\n  ) =>\n  (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\n    updateDatasourcePluginSecureJsonDataOption(props, key, event.currentTarget.value);\n  };\n\nexport const onUpdateDatasourceJsonDataOptionSelect =\n  <J extends DataSourceJsonData, S, K extends keyof J>(props: DataSourcePluginOptionsEditorProps<J, S>, key: K) =>\n  (selected: SelectableValue) => {\n    updateDatasourcePluginJsonDataOption(props, key, selected.value);\n  };\n\nexport const onUpdateDatasourceJsonDataOptionChecked =\n  <J extends DataSourceJsonData, S, K extends keyof J>(props: DataSourcePluginOptionsEditorProps<J, S>, key: K) =>\n  (event: React.SyntheticEvent<HTMLInputElement>) => {\n    updateDatasourcePluginJsonDataOption(props, key, event.currentTarget.checked);\n  };\n\nexport const onUpdateDatasourceSecureJsonDataOptionSelect =\n  <J extends DataSourceJsonData, S extends {} = KeyValue>(\n    props: DataSourcePluginOptionsEditorProps<J, S>,\n    key: string\n  ) =>\n  (selected: SelectableValue) => {\n    updateDatasourcePluginSecureJsonDataOption(props, key, selected.value);\n  };\n\nexport const onUpdateDatasourceResetOption =\n  (props: DataSourcePluginOptionsEditorProps, key: string) =>\n  (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    updateDatasourcePluginResetOption(props, key);\n  };\n\nexport function updateDatasourcePluginOption<J extends DataSourceJsonData, S extends {} = KeyValue>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: keyof DataSourceSettings,\n  val: unknown\n) {\n  const config = props.options;\n\n  props.onOptionsChange({\n    ...config,\n    [key]: val,\n  });\n}\n\nexport const updateDatasourcePluginJsonDataOption = <J extends DataSourceJsonData, S, K extends keyof J>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: K,\n  val: unknown\n) => {\n  const config = props.options;\n\n  props.onOptionsChange({\n    ...config,\n    jsonData: {\n      ...config.jsonData,\n      [key]: val,\n    },\n  });\n};\n\nexport const updateDatasourcePluginSecureJsonDataOption = <J extends DataSourceJsonData, S extends {} = KeyValue>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: string,\n  val: unknown\n) => {\n  const config = props.options;\n\n  props.onOptionsChange({\n    ...config,\n    secureJsonData: {\n      ...(config.secureJsonData ? config.secureJsonData : ({} as S)),\n      [key]: val,\n    },\n  });\n};\n\nexport const updateDatasourcePluginResetOption = <J extends DataSourceJsonData, S extends {} = KeyValue>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: string\n) => {\n  const config = props.options;\n  props.onOptionsChange({\n    ...config,\n    secureJsonData: {\n      ...(config.secureJsonData ? config.secureJsonData : ({} as S)),\n      [key]: '',\n    },\n    secureJsonFields: {\n      ...config.secureJsonFields,\n      [key]: false,\n    },\n  });\n};\n"],"names":[],"mappings":"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"}