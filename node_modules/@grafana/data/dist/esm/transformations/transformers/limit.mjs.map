{"version":3,"file":"limit.mjs","sources":["../../../../src/transformations/transformers/limit.ts"],"sourcesContent":["import { map } from 'rxjs/operators';\n\nimport { DataTransformerInfo } from '../../types/transformations';\n\nimport { DataTransformerID } from './ids';\n\nexport interface LimitTransformerOptions {\n  limitField?: number | string;\n}\n\nconst DEFAULT_LIMIT_FIELD = 10;\n\nexport const limitTransformer: DataTransformerInfo<LimitTransformerOptions> = {\n  id: DataTransformerID.limit,\n  name: 'Limit',\n  description: 'Limit the number of items to the top N',\n  defaultOptions: {\n    limitField: DEFAULT_LIMIT_FIELD,\n  },\n\n  operator: (options, ctx) => (source) =>\n    source.pipe(\n      map((data) => {\n        let limit = DEFAULT_LIMIT_FIELD;\n        if (options.limitField !== undefined) {\n          if (typeof options.limitField === 'string') {\n            limit = parseInt(options.limitField, 10);\n          } else {\n            limit = options.limitField;\n          }\n        }\n\n        return data.map((frame) => {\n          if (frame.length > limit) {\n            return {\n              ...frame,\n              fields: frame.fields.map((f) => {\n                return {\n                  ...f,\n                  values:\n                    limit >= 0 ? f.values.slice(0, limit) : f.values.slice(f.values.length + limit, f.values.length),\n                };\n              }),\n              length: Math.abs(limit),\n            };\n          }\n\n          return frame;\n        });\n      })\n    ),\n};\n"],"names":[],"mappings":";;;AAUA,MAAM,mBAAsB,GAAA,EAAA;AAErB,MAAM,gBAAiE,GAAA;AAAA,EAC5E,IAAI,iBAAkB,CAAA,KAAA;AAAA,EACtB,IAAM,EAAA,OAAA;AAAA,EACN,WAAa,EAAA,wCAAA;AAAA,EACb,cAAgB,EAAA;AAAA,IACd,UAAY,EAAA;AAAA,GACd;AAAA,EAEA,UAAU,CAAC,OAAA,EAAS,GAAQ,KAAA,CAAC,WAC3B,MAAO,CAAA,IAAA;AAAA,IACL,GAAA,CAAI,CAAC,IAAS,KAAA;AACZ,MAAA,IAAI,KAAQ,GAAA,mBAAA;AACZ,MAAI,IAAA,OAAA,CAAQ,eAAe,SAAW,EAAA;AACpC,QAAI,IAAA,OAAO,OAAQ,CAAA,UAAA,KAAe,QAAU,EAAA;AAC1C,UAAQ,KAAA,GAAA,QAAA,CAAS,OAAQ,CAAA,UAAA,EAAY,EAAE,CAAA;AAAA,SAClC,MAAA;AACL,UAAA,KAAA,GAAQ,OAAQ,CAAA,UAAA;AAAA;AAClB;AAGF,MAAO,OAAA,IAAA,CAAK,GAAI,CAAA,CAAC,KAAU,KAAA;AACzB,QAAI,IAAA,KAAA,CAAM,SAAS,KAAO,EAAA;AACxB,UAAO,OAAA;AAAA,YACL,GAAG,KAAA;AAAA,YACH,MAAQ,EAAA,KAAA,CAAM,MAAO,CAAA,GAAA,CAAI,CAAC,CAAM,KAAA;AAC9B,cAAO,OAAA;AAAA,gBACL,GAAG,CAAA;AAAA,gBACH,QACE,KAAS,IAAA,CAAA,GAAI,EAAE,MAAO,CAAA,KAAA,CAAM,GAAG,KAAK,CAAA,GAAI,CAAE,CAAA,MAAA,CAAO,MAAM,CAAE,CAAA,MAAA,CAAO,SAAS,KAAO,EAAA,CAAA,CAAE,OAAO,MAAM;AAAA,eACnG;AAAA,aACD,CAAA;AAAA,YACD,MAAA,EAAQ,IAAK,CAAA,GAAA,CAAI,KAAK;AAAA,WACxB;AAAA;AAGF,QAAO,OAAA,KAAA;AAAA,OACR,CAAA;AAAA,KACF;AAAA;AAEP;;;;"}