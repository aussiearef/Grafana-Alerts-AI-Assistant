{"version":3,"file":"FieldCache.mjs","sources":["../../../src/dataframe/FieldCache.ts"],"sourcesContent":["import { DataFrame, Field, FieldType } from '../types/dataFrame';\n\nimport { guessFieldTypeForField } from './processDataFrame';\n\nexport interface FieldWithIndex extends Field {\n  index: number;\n}\n\nexport class FieldCache {\n  fields: FieldWithIndex[] = [];\n\n  private fieldByName: { [key: string]: FieldWithIndex } = {};\n  private fieldByType: { [key: string]: FieldWithIndex[] } = {};\n\n  constructor(data: DataFrame) {\n    this.fields = data.fields.map((field, idx) => ({\n      ...field,\n      index: idx,\n    }));\n\n    for (let i = 0; i < data.fields.length; i++) {\n      const field = data.fields[i];\n      // Make sure it has a type\n      if (field.type === FieldType.other) {\n        const t = guessFieldTypeForField(field);\n        if (t) {\n          field.type = t;\n        }\n      }\n      if (!this.fieldByType[field.type]) {\n        this.fieldByType[field.type] = [];\n      }\n      this.fieldByType[field.type].push({\n        ...field,\n        index: i,\n      });\n\n      if (this.fieldByName[field.name]) {\n        console.warn('Duplicate field names in DataFrame: ', field.name);\n      } else {\n        this.fieldByName[field.name] = { ...field, index: i };\n      }\n    }\n  }\n\n  getFields(type?: FieldType): FieldWithIndex[] {\n    if (!type) {\n      return [...this.fields]; // All fields\n    }\n    const fields = this.fieldByType[type];\n    if (fields) {\n      return [...fields];\n    }\n    return [];\n  }\n\n  hasFieldOfType(type: FieldType): boolean {\n    const types = this.fieldByType[type];\n    return types && types.length > 0;\n  }\n\n  getFirstFieldOfType(type: FieldType, includeHidden = false): FieldWithIndex | undefined {\n    const fields = this.fieldByType[type];\n    const firstField = fields?.find((field) => includeHidden || !field.config.custom?.hidden);\n    return firstField;\n  }\n\n  hasFieldNamed(name: string): boolean {\n    return !!this.fieldByName[name];\n  }\n\n  hasFieldWithNameAndType(name: string, type: FieldType): boolean {\n    return !!this.fieldByName[name] && this.fieldByType[type].filter((field) => field.name === name).length > 0;\n  }\n\n  /**\n   * Returns the first field with the given name.\n   */\n  getFieldByName(name: string): FieldWithIndex | undefined {\n    return this.fieldByName[name];\n  }\n\n  /**\n   * Returns the fields with the given label.\n   */\n  getFieldsByLabel(label: string, value: string): FieldWithIndex[] {\n    return Object.values(this.fieldByName).filter((f) => {\n      return f.labels && f.labels[label] === value;\n    });\n  }\n}\n"],"names":[],"mappings":"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"}