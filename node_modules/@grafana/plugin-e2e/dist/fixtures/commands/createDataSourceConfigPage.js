'use strict';

var createDataSource = require('./createDataSource.js');
var DataSourceConfigPage = require('../../models/pages/DataSourceConfigPage.js');

const createDataSourceConfigPage = async ({ request, page, selectors, grafanaVersion, grafanaAPIClient }, use, testInfo) => {
  let datasourceConfigPage;
  let deleteDataSource = true;
  await use(async (args) => {
    deleteDataSource = args.deleteDataSourceAfterTest ?? true;
    const datasource = await createDataSource.createDataSourceViaAPI(grafanaAPIClient, args);
    datasourceConfigPage = new DataSourceConfigPage.DataSourceConfigPage({ page, selectors, grafanaVersion, request, testInfo }, datasource);
    await datasourceConfigPage.goto();
    return datasourceConfigPage;
  });
  deleteDataSource && await datasourceConfigPage?.deleteDataSource();
};

exports.createDataSourceConfigPage = createDataSourceConfigPage;
