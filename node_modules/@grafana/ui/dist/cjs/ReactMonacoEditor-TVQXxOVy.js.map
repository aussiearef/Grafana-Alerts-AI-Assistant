{"version":3,"file":"ReactMonacoEditor-TVQXxOVy.js","sources":["../../src/components/Monaco/theme.ts","../../src/components/Monaco/ReactMonacoEditor.tsx"],"sourcesContent":["import tinycolor from 'tinycolor2';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nimport { Monaco, monacoTypes } from './types';\n\nfunction getColors(theme?: GrafanaTheme2): monacoTypes.editor.IColors {\n  if (theme === undefined) {\n    return {};\n  } else {\n    const colors: Record<string, string> = {\n      'editor.background': theme.components.input.background,\n      'minimap.background': theme.colors.background.secondary,\n    };\n\n    Object.keys(colors).forEach((resultKey) => {\n      colors[resultKey] = normalizeColorForMonaco(colors[resultKey]);\n    });\n    return colors;\n  }\n}\n\nfunction normalizeColorForMonaco(color?: string): string {\n  // monaco needs 6char hex colors\n  // see https://github.com/grafana/grafana/issues/43158\n  return tinycolor(color).toHexString();\n}\n\n// we support calling this without a theme, it will make sure the themes\n// are registered in monaco, even if the colors are not perfect.\nexport default function defineThemes(monaco: Monaco, theme?: GrafanaTheme2) {\n  // color tokens are defined here https://github.com/microsoft/vscode/blob/main/src/vs/platform/theme/common/colorRegistry.ts#L174\n  const colors = getColors(theme);\n  monaco.editor.defineTheme('grafana-dark', {\n    base: 'vs-dark',\n    inherit: true,\n    colors: colors,\n    // fallback syntax highlighting for languages that microsoft doesn't handle (ex cloudwatch's metric math)\n    rules: [\n      { token: 'predefined', foreground: normalizeColorForMonaco(theme?.visualization.getColorByName('purple')) },\n      { token: 'operator', foreground: normalizeColorForMonaco(theme?.visualization.getColorByName('orange')) },\n      { token: 'tag', foreground: normalizeColorForMonaco(theme?.visualization.getColorByName('green')) },\n    ],\n  });\n\n  monaco.editor.defineTheme('grafana-light', {\n    base: 'vs',\n    inherit: true,\n    colors: colors,\n    // fallback syntax highlighting for languages that microsoft doesn't handle (ex cloudwatch's metric math)\n    rules: [\n      { token: 'predefined', foreground: normalizeColorForMonaco(theme?.visualization.getColorByName('purple')) },\n      { token: 'operator', foreground: normalizeColorForMonaco(theme?.visualization.getColorByName('orange')) },\n      { token: 'tag', foreground: normalizeColorForMonaco(theme?.visualization.getColorByName('green')) },\n    ],\n  });\n}\n","import Editor, { loader as monacoEditorLoader, Monaco } from '@monaco-editor/react';\nimport * as monaco from 'monaco-editor';\nimport { useCallback, useEffect } from 'react';\n\nimport { useTheme2 } from '../../themes';\n\nimport defineThemes from './theme';\nimport type { ReactMonacoEditorProps } from './types';\n\n// pass the monaco editor to the loader to bypass requirejs\nmonacoEditorLoader.config({ monaco });\n\nexport const ReactMonacoEditor = (props: ReactMonacoEditorProps) => {\n  const { beforeMount, onMount, options, ...restProps } = props;\n\n  const theme = useTheme2();\n  const onMonacoBeforeMount = useCallback(\n    (monaco: Monaco) => {\n      beforeMount?.(monaco);\n    },\n    [beforeMount]\n  );\n\n  useEffect(() => {\n    defineThemes(monaco, theme);\n  }, [theme]);\n\n  return (\n    <Editor\n      {...restProps}\n      options={{\n        ...options,\n        fontFamily: theme.typography.code.fontFamily,\n      }}\n      theme={theme.isDark ? 'grafana-dark' : 'grafana-light'}\n      beforeMount={onMonacoBeforeMount}\n      onMount={(editor, monaco) => {\n        // we use a custom font in our monaco editor\n        // we need monaco to remeasure the fonts after they are loaded to prevent alignment issues\n        // see https://github.com/microsoft/monaco-editor/issues/648#issuecomment-564978560\n        document.fonts.ready.then(() => {\n          monaco.editor.remeasureFonts();\n        });\n        onMount?.(editor, monaco);\n      }}\n    />\n  );\n};\n"],"names":["tinycolor","monacoEditorLoader","monaco","useTheme2","useCallback","useEffect","jsx","Editor"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,SAAS,UAAU,KAAmD,EAAA;AACpE,EAAA,IAAI,UAAU,SAAW,EAAA;AACvB,IAAA,OAAO,EAAC;AAAA,GACH,MAAA;AACL,IAAA,MAAM,MAAiC,GAAA;AAAA,MACrC,mBAAA,EAAqB,KAAM,CAAA,UAAA,CAAW,KAAM,CAAA,UAAA;AAAA,MAC5C,oBAAA,EAAsB,KAAM,CAAA,MAAA,CAAO,UAAW,CAAA;AAAA,KAChD;AAEA,IAAA,MAAA,CAAO,IAAK,CAAA,MAAM,CAAE,CAAA,OAAA,CAAQ,CAAC,SAAc,KAAA;AACzC,MAAA,MAAA,CAAO,SAAS,CAAA,GAAI,uBAAwB,CAAA,MAAA,CAAO,SAAS,CAAC,CAAA;AAAA,KAC9D,CAAA;AACD,IAAO,OAAA,MAAA;AAAA;AAEX;AAEA,SAAS,wBAAwB,KAAwB,EAAA;AAGvD,EAAO,OAAAA,0BAAA,CAAU,KAAK,CAAA,CAAE,WAAY,EAAA;AACtC;AAIwB,SAAA,YAAA,CAAa,QAAgB,KAAuB,EAAA;AAE1E,EAAM,MAAA,MAAA,GAAS,UAAU,KAAK,CAAA;AAC9B,EAAO,MAAA,CAAA,MAAA,CAAO,YAAY,cAAgB,EAAA;AAAA,IACxC,IAAM,EAAA,SAAA;AAAA,IACN,OAAS,EAAA,IAAA;AAAA,IACT,MAAA;AAAA;AAAA,IAEA,KAAO,EAAA;AAAA,MACL,EAAE,OAAO,YAAc,EAAA,UAAA,EAAY,wBAAwB,KAAO,IAAA,IAAA,GAAA,SAAA,GAAA,KAAA,CAAA,aAAA,CAAc,cAAe,CAAA,QAAA,CAAS,CAAE,EAAA;AAAA,MAC1G,EAAE,OAAO,UAAY,EAAA,UAAA,EAAY,wBAAwB,KAAO,IAAA,IAAA,GAAA,SAAA,GAAA,KAAA,CAAA,aAAA,CAAc,cAAe,CAAA,QAAA,CAAS,CAAE,EAAA;AAAA,MACxG,EAAE,OAAO,KAAO,EAAA,UAAA,EAAY,wBAAwB,KAAO,IAAA,IAAA,GAAA,SAAA,GAAA,KAAA,CAAA,aAAA,CAAc,cAAe,CAAA,OAAA,CAAQ,CAAE;AAAA;AACpG,GACD,CAAA;AAED,EAAO,MAAA,CAAA,MAAA,CAAO,YAAY,eAAiB,EAAA;AAAA,IACzC,IAAM,EAAA,IAAA;AAAA,IACN,OAAS,EAAA,IAAA;AAAA,IACT,MAAA;AAAA;AAAA,IAEA,KAAO,EAAA;AAAA,MACL,EAAE,OAAO,YAAc,EAAA,UAAA,EAAY,wBAAwB,KAAO,IAAA,IAAA,GAAA,SAAA,GAAA,KAAA,CAAA,aAAA,CAAc,cAAe,CAAA,QAAA,CAAS,CAAE,EAAA;AAAA,MAC1G,EAAE,OAAO,UAAY,EAAA,UAAA,EAAY,wBAAwB,KAAO,IAAA,IAAA,GAAA,SAAA,GAAA,KAAA,CAAA,aAAA,CAAc,cAAe,CAAA,QAAA,CAAS,CAAE,EAAA;AAAA,MACxG,EAAE,OAAO,KAAO,EAAA,UAAA,EAAY,wBAAwB,KAAO,IAAA,IAAA,GAAA,SAAA,GAAA,KAAA,CAAA,aAAA,CAAc,cAAe,CAAA,OAAA,CAAQ,CAAE;AAAA;AACpG,GACD,CAAA;AACH;;AC9CAC,aAAmB,CAAA,MAAA,CAAO,UAAEC,iBAAA,EAAQ,CAAA;AAEvB,MAAA,iBAAA,GAAoB,CAAC,KAAkC,KAAA;AAClE,EAAA,MAAM,EAAE,WAAa,EAAA,OAAA,EAAS,OAAS,EAAA,GAAG,WAAc,GAAA,KAAA;AAExD,EAAA,MAAM,QAAQC,eAAU,EAAA;AACxB,EAAA,MAAM,mBAAsB,GAAAC,iBAAA;AAAA,IAC1B,CAACF,OAAmB,KAAA;AAClB,MAAcA,WAAAA,IAAAA,IAAAA,GAAAA,SAAAA,GAAAA,WAAAA,CAAAA,OAAAA,CAAAA;AAAA,KAChB;AAAA,IACA,CAAC,WAAW;AAAA,GACd;AAEA,EAAAG,eAAA,CAAU,MAAM;AACd,IAAA,YAAA,CAAaH,mBAAQ,KAAK,CAAA;AAAA,GAC5B,EAAG,CAAC,KAAK,CAAC,CAAA;AAEV,EACE,uBAAAI,cAAA;AAAA,IAACC,uBAAA;AAAA,IAAA;AAAA,MACE,GAAG,SAAA;AAAA,MACJ,OAAS,EAAA;AAAA,QACP,GAAG,OAAA;AAAA,QACH,UAAA,EAAY,KAAM,CAAA,UAAA,CAAW,IAAK,CAAA;AAAA,OACpC;AAAA,MACA,KAAA,EAAO,KAAM,CAAA,MAAA,GAAS,cAAiB,GAAA,eAAA;AAAA,MACvC,WAAa,EAAA,mBAAA;AAAA,MACb,OAAA,EAAS,CAAC,MAAA,EAAQL,OAAW,KAAA;AAI3B,QAAS,QAAA,CAAA,KAAA,CAAM,KAAM,CAAA,IAAA,CAAK,MAAM;AAC9B,UAAAA,OAAAA,CAAO,OAAO,cAAe,EAAA;AAAA,SAC9B,CAAA;AACD,QAAA,OAAA,IAAA,IAAA,GAAA,SAAA,GAAA,OAAA,CAAU,MAAQA,EAAAA,OAAAA,CAAAA;AAAA;AACpB;AAAA,GACF;AAEJ;;;;"}